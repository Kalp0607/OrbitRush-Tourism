<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= tour.name %> | OrbitRush Tourism</title>
    <%- include("partials/head") %>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #f8f9fa;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.6;
      }

      /* Hero Section */
      .hero-section {
        background: linear-gradient(
            135deg,
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.3)
          ),
          url("<%= tour.coverImage %>");
        background-size: cover;
        background-position: center;
        height: 70vh;
        display: flex;
        align-items: center;
        color: white;
        position: relative;
        overflow: hidden;
        padding: 2rem 0;
      }

      .hero-content {
        position: relative;
        z-index: 2;
        width: 100%;
      }

      .hero-section h1 {
        font-size: 3.5rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        line-height: 1.2;
      }

      .hero-location {
        font-size: 1.3rem;
        margin-bottom: 2rem;
        opacity: 0.9;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .hero-tags {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
        justify-content: flex-start;
        align-items: center;
        margin-top: 1rem;
      }

      .hero-tag {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        padding: 0.8rem 1.2rem;
        border-radius: 25px;
        font-size: 0.95rem;
        border: 1px solid rgba(255, 255, 255, 0.3);
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        margin-bottom: 0.5rem;
      }

      .hero-tag:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .hero-tag i {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      /* Main Content */
      .main-content {
        margin-top: -100px;
        position: relative;
        z-index: 3;
      }

      .tour-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .tour-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      }

      .card-content {
        padding: 2.5rem;
      }

      /* Booking Section */
      .booking-sidebar {
        position: sticky;
        top: 2rem;
      }

      .price-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 20px;
        padding: 2.5rem;
        text-align: center;
        margin-bottom: 2rem;
      }

      .price {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
      }

      .price-per {
        opacity: 0.8;
        font-size: 1.1rem;
      }

      .btn-book {
        background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
        color: white;
        padding: 1.2rem 2.5rem;
        border: none;
        border-radius: 50px;
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .btn-book:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4);
      }

      /* Available Dates Section - NEW STYLES */
      .dates-container {
        margin-top: 1.5rem;
      }

      .dates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .date-badge {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: 2px solid #dee2e6;
        border-radius: 12px;
        padding: 1rem 1.2rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        transition: all 0.3s ease;
        cursor: default;
      }

      .date-badge:hover {
        border-color: #667eea;
        background: linear-gradient(135deg, #e8f4fd 0%, #f0f8ff 100%);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
      }

      .date-badge i {
        font-size: 1.3rem;
        color: #667eea;
      }

      .date-badge span {
        font-size: 0.95rem;
        color: #2c3e50;
        font-weight: 500;
      }

      .show-more-wrapper {
        text-align: center;
        margin-top: 1rem;
      }

      .show-more-btn {
        background: white;
        border: 2px solid #667eea;
        color: #667eea;
        padding: 0.8rem 2rem;
        border-radius: 25px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.75rem;
      }

      .show-more-btn:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
      }

      .show-more-btn i {
        transition: transform 0.3s ease;
      }

      .show-more-btn.expanded i {
        transform: rotate(180deg);
      }

      .dates-note {
        background: #f8f9fa;
        border-left: 4px solid #667eea;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-top: 1.5rem;
      }

      .dates-note i {
        color: #667eea;
        font-size: 1.1rem;
      }

      .dates-note span {
        color: #6c757d;
        font-size: 0.95rem;
      }

      .no-dates-message {
        text-align: center;
        padding: 2rem;
        background: #f8f9fa;
        border-radius: 15px;
        color: #6c757d;
        font-style: italic;
      }

      .no-dates-message i {
        font-size: 3rem;
        color: #dee2e6;
        margin-bottom: 1rem;
        display: block;
      }

      /* Quick Info Cards */
      .quick-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .info-item {
        background: white;
        padding: 1.5rem;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease;
      }

      .info-item:hover {
        transform: translateY(-3px);
      }

      .info-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      /* Sections */
      .section-title {
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: #2c3e50;
        position: relative;
        padding-bottom: 0.5rem;
      }

      .section-title::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 4px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 2px;
      }

      /* Itinerary */
      .itinerary-day {
        background: #f8f9fa;
        border-left: 4px solid #667eea;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border-radius: 0 10px 10px 0;
        position: relative;
      }

      .itinerary-day::before {
        content: "";
        position: absolute;
        left: -8px;
        top: 1.5rem;
        width: 16px;
        height: 16px;
        background: #667eea;
        border-radius: 50%;
      }

      .day-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 0.5rem;
      }

      /* Gallery Slider Styles */
      .gallery-slider-container {
        position: relative;
        margin-top: 1rem;
        background: #f8f9fa;
        border-radius: 15px;
        padding: 1rem;
        overflow: hidden;
      }

      .gallery-slider {
        position: relative;
        overflow: hidden;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .slider-track {
        display: flex;
        transition: transform 0.5s ease-in-out;
        gap: 1rem;
        padding: 0.5rem;
        width: 100%;
      }

      .slide-item {
        flex: 0 0 calc(33.333% - 0.67rem);
        position: relative;
        border-radius: 10px;
        overflow: hidden;
        aspect-ratio: 4/3;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        min-width: 0;
      }

      .slide-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .slide-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
      }

      .slide-item:hover img {
        transform: scale(1.05);
      }

      .slide-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .slide-item:hover .slide-overlay {
        opacity: 1;
      }

      .slide-overlay i {
        color: white;
        font-size: 2rem;
      }

      /* Slider Controls */
      .slider-controls {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        transform: translateY(-50%);
        display: flex;
        justify-content: space-between;
        pointer-events: none;
        z-index: 2;
      }

      .slider-btn {
        background: rgba(255, 255, 255, 0.9);
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        pointer-events: all;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        margin: 0 1rem;
      }

      .slider-btn:hover {
        background: white;
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .slider-btn i {
        color: #333;
        font-size: 1.2rem;
      }

      /* Slider Indicators */
      .slider-indicators {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 1.5rem;
      }

      .indicator-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: none;
        background: #ccc;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .indicator-dot.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        transform: scale(1.2);
      }

      .indicator-dot:hover {
        background: #999;
        transform: scale(1.1);
      }

      /* Auto-play Control */
      .autoplay-control {
        position: absolute;
        top: 1rem;
        right: 1rem;
        z-index: 3;
      }

      .autoplay-btn {
        background: rgba(0, 0, 0, 0.7);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .autoplay-btn:hover {
        background: rgba(0, 0, 0, 0.9);
        transform: scale(1.1);
      }

      .autoplay-btn i {
        color: white;
        font-size: 1rem;
      }

      /* Includes/Excludes */
      .includes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
      }

      .includes-section {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      }

      .includes-section.included {
        border-left: 4px solid #27ae60;
      }

      .includes-section.excluded {
        border-left: 4px solid #e74c3c;
      }

      .includes-list {
        list-style: none;
        padding: 0;
      }

      .includes-list li {
        padding: 0.75rem 0;
        border-bottom: 1px solid #eee;
        position: relative;
        padding-left: 2rem;
      }

      .includes-list li:last-child {
        border-bottom: none;
      }

      .includes-list li::before {
        position: absolute;
        left: 0;
        top: 0.9rem;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        color: white;
        font-size: 0.8rem;
        text-align: center;
        line-height: 16px;
      }

      .included li::before {
        content: "âœ“";
        background: #27ae60;
      }

      .excluded li::before {
        content: "âœ—";
        background: #e74c3c;
      }

      /* COMMENT & RATING STYLES */
      .comment-form {
        background: white;
        border-radius: 15px;
        padding: 2.5rem;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        margin-bottom: 2rem;
        border: 1px solid #e5e7eb;
      }

      .rating-section {
        margin-bottom: 2rem;
      }

      .rating-label {
        display: block;
        font-weight: 600;
        color: #2c3e50;
        font-size: 1.1rem;
        margin-bottom: 1rem;
      }

      .star-rating-wrapper {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 12px;
        border: 2px solid #e5e7eb;
        transition: border-color 0.3s ease;
      }

      .star-rating-wrapper:hover {
        border-color: #667eea;
      }

      .star-rating {
        display: flex;
        gap: 0.25rem;
      }

      .star {
        font-size: 2.2rem;
        color: #d1d5db;
        cursor: pointer;
        transition: all 0.2s ease;
        user-select: none;
        line-height: 1;
      }

      .star:hover {
        transform: scale(1.1);
        color: #fbbf24;
      }

      .star.active {
        color: #fbbf24;
      }

      .star.selected {
        color: #f59e0b;
      }

      .rating-feedback {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-left: 1rem;
      }

      .rating-emoji {
        font-size: 2rem;
        transition: all 0.3s ease;
      }

      .rating-text {
        font-size: 0.95rem;
        color: #6b7280;
        font-weight: 600;
      }

      .submit-review-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 1rem 2.5rem;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1.1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-top: 1.5rem;
      }

      .submit-review-btn:enabled:hover {
        background: linear-gradient(135deg, #5a67d8, #6b46c1);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      }

      .submit-review-btn:disabled {
        background: #9ca3af;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      /* Reviews */
      .review-item {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 1.5rem;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #f1f5f9;
      }

      .review-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .reviewer-avatar {
        width: 45px;
        height: 45px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 1.2rem;
        flex-shrink: 0;
      }

      .review-stars {
        display: flex;
        gap: 0.2rem;
        margin-left: auto;
        align-items: center;
      }

      .review-stars .star {
        font-size: 1.1rem;
        color: #d1d5db;
      }

      .review-stars .star.filled {
        color: #fbbf24;
      }

      .review-rating-emoji {
        margin-left: 0.75rem;
        font-size: 1.4rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-control {
        width: 100%;
        padding: 1.2rem;
        border: 2px solid #e5e7eb;
        border-radius: 10px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
        font-family: inherit;
        resize: vertical;
        line-height: 1.5;
      }

      .form-control:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      /* Responsive */
      @media (max-width: 1200px) {
        .hero-section {
          height: 75vh;
        }

        .hero-section h1 {
          font-size: 3rem;
          margin-bottom: 1.2rem;
        }

        .hero-location {
          font-size: 1.2rem;
          margin-bottom: 1.8rem;
        }

        .hero-tag {
          font-size: 0.9rem;
          padding: 0.7rem 1rem;
        }
      }

      @media (max-width: 992px) {
        .hero-section {
          height: 80vh;
          padding: 3rem 0;
        }

        .hero-section h1 {
          font-size: 2.8rem;
        }

        .hero-tags {
          gap: 1rem;
          justify-content: center;
        }
      }

      @media (max-width: 768px) {
        .hero-section {
          height: 85vh;
          padding: 2rem 0;
          text-align: center;
        }

        .hero-section h1 {
          font-size: 2.5rem;
          margin-bottom: 1rem;
        }

        .hero-location {
          font-size: 1.1rem;
          margin-bottom: 1.5rem;
          justify-content: center;
        }

        .hero-tags {
          gap: 0.8rem;
          justify-content: center;
          flex-direction: row;
        }

        .hero-tag {
          font-size: 0.85rem;
          padding: 0.6rem 0.9rem;
        }

        .main-content {
          margin-top: -50px;
        }

        .card-content {
          padding: 1.5rem;
        }

        .price {
          font-size: 2.5rem;
        }

        .dates-grid {
          grid-template-columns: 1fr;
        }

        .date-badge {
          padding: 0.9rem 1rem;
        }

        .date-badge span {
          font-size: 0.9rem;
        }

        .slide-item {
          flex: 0 0 calc(50% - 0.5rem);
        }

        .slider-btn {
          width: 40px;
          height: 40px;
          margin: 0 0.5rem;
        }

        .slider-btn i {
          font-size: 1rem;
        }
      }

      @media (max-width: 480px) {
        .hero-section {
          height: 90vh;
        }

        .hero-section h1 {
          font-size: 2rem;
        }

        .hero-tags {
          gap: 0.5rem;
          flex-direction: column;
          align-items: center;
        }

        .hero-tag {
          font-size: 0.8rem;
          padding: 0.5rem 0.8rem;
          min-width: 200px;
          justify-content: center;
        }

        .slide-item {
          flex: 0 0 100%;
        }

        .slider-track {
          gap: 0.5rem;
        }
      }

      /* Animations */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .tour-card {
        animation: fadeInUp 0.6s ease;
      }

      .tour-card:nth-child(even) {
        animation-delay: 0.2s;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .slide-item {
        animation: slideIn 0.6s ease;
      }
    </style>
  </head>
  <body>
    <%- include("partials/nav") %>

    <!-- Hero Section -->
    <div class="hero-section">
      <div class="container">
        <div class="hero-content">
          <h1><%= tour.name %></h1>
          <p class="hero-location">
            <i class="fas fa-map-marker-alt"></i> <%= tour.location %>
          </p>
          <div class="hero-tags">
            <span class="hero-tag">
              <i class="far fa-clock"></i> <%= tour.duration %>
            </span>
            <span class="hero-tag">
              <i class="fas fa-users"></i> Max <%= tour.maxGroupSize || '20' %>
              People
            </span>
            <span class="hero-tag">
              <i class="fas fa-star"></i> <%= tour.ratingsAverage || '4.5' %>
              Rating
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="container main-content">
      <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
          <!-- Quick Info -->
          <div class="quick-info">
            <div class="info-item">
              <div class="info-icon">
                <i class="far fa-calendar"></i>
              </div>
              <h4>Duration</h4>
              <p><%= tour.duration %></p>
            </div>
            <div class="info-item">
              <div class="info-icon">
                <i class="fas fa-signal"></i>
              </div>
              <h4>Difficulty</h4>
              <p><%= tour.difficulty || 'Moderate' %></p>
            </div>
            <div class="info-item">
              <div class="info-icon">
                <i class="fas fa-users"></i>
              </div>
              <h4>Group Size</h4>
              <p>Max <%= tour.maxGroupSize || '20' %></p>
            </div>
            <div class="info-item">
              <div class="info-icon">
                <i class="fas fa-map-marked-alt"></i>
              </div>
              <h4>Start Location</h4>
              <p><%= tour.startLocation || tour.location %></p>
            </div>
          </div>

          <!-- Tour Overview -->
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Tour Overview</h2>
              <p style="font-size: 1.1rem; color: #6c757d; line-height: 1.8">
                <%= tour.overview %>
              </p>
            </div>
          </div>

          <!-- Available Dates - UPDATED SECTION -->
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">
                <i
                  class="fas fa-calendar-alt"
                  style="margin-right: 0.5rem; color: #667eea"
                ></i>
                Available Dates
              </h2>

              <% if (tour.availableDates && tour.availableDates.length > 0) { %>
              <div class="dates-container">
                <!-- Show first 4 dates initially -->
                <div class="dates-grid" id="datesGrid">
                  <% tour.availableDates.slice(0, 4).forEach((date, index) => {
                  %> <% const dateObj = new Date(date); const formattedDate =
                  dateObj.toLocaleDateString('en-US', { weekday: 'short', year:
                  'numeric', month: 'short', day: 'numeric' }); %>
                  <div class="date-badge">
                    <i class="far fa-calendar-check"></i>
                    <span><%= formattedDate %></span>
                  </div>
                  <% }) %>
                </div>

                <!-- Hidden dates (shown on expand) -->
                <% if (tour.availableDates.length > 4) { %>
                <div class="dates-grid" id="hiddenDates" style="display: none">
                  <% tour.availableDates.slice(4).forEach((date, index) => { %>
                  <% const dateObj = new Date(date); const formattedDate =
                  dateObj.toLocaleDateString('en-US', { weekday: 'short', year:
                  'numeric', month: 'short', day: 'numeric' }); %>
                  <div class="date-badge">
                    <i class="far fa-calendar-check"></i>
                    <span><%= formattedDate %></span>
                  </div>
                  <% }) %>
                </div>

                <!-- Show More Button -->
                <div class="show-more-wrapper">
                  <button
                    class="show-more-btn"
                    id="showMoreBtn"
                    onclick="toggleDates()"
                  >
                    <span id="btnText"
                      >Show All Dates (<%= tour.availableDates.length - 4 %>
                      more)</span
                    >
                    <i class="fas fa-chevron-down" id="btnIcon"></i>
                  </button>
                </div>
                <% } %>

                <div class="dates-note">
                  <i class="fas fa-info-circle"></i>
                  <span>Select your preferred date during checkout</span>
                </div>
              </div>
              <% } else { %>
              <div class="no-dates-message">
                <i class="fas fa-calendar-times"></i>
                <h4 style="margin-bottom: 1rem">No Available Dates</h4>
                <p>
                  This tour currently has no scheduled dates. Please contact us
                  for custom booking options.
                </p>
              </div>
              <% } %>
            </div>
          </div>

          <!-- Tour Highlights -->
          <% if (tour.highlights && tour.highlights.length > 0) { %>
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Tour Highlights</h2>
              <div class="row">
                <% tour.highlights.forEach(highlight => { %>
                <div class="col-md-6 mb-3">
                  <div style="display: flex; align-items: center">
                    <i
                      class="fas fa-check-circle"
                      style="
                        color: #27ae60;
                        margin-right: 1rem;
                        font-size: 1.2rem;
                      "
                    ></i>
                    <span style="font-size: 1.1rem"><%= highlight %></span>
                  </div>
                </div>
                <% }) %>
              </div>
            </div>
          </div>
          <% } %>

          <!-- Itinerary -->
          <% if (tour.itinerary && tour.itinerary.length > 0) { %>
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Day-by-Day Itinerary</h2>
              <% tour.itinerary.forEach((day, index) => { %>
              <div class="itinerary-day">
                <h4 class="day-title">
                  Day <%= index + 1 %>: <%= day.title %>
                </h4>
                <p style="color: #6c757d; margin-bottom: 0.5rem">
                  <i class="far fa-clock"></i> <%= day.time || 'Full Day' %>
                </p>
                <p style="line-height: 1.7"><%= day.description %></p>
              </div>
              <% }) %>
            </div>
          </div>
          <% } %>

          <!-- Gallery -->
          <% if (tour.moreImages && tour.moreImages.length > 0) { %>
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Photo Gallery</h2>
              <div class="gallery-slider-container">
                <div class="gallery-slider" id="gallerySlider">
                  <div class="slider-track" id="sliderTrack">
                    <% tour.moreImages.forEach((image, index) => { %>
                    <div class="slide-item">
                      <img
                        src="<%= image %>"
                        alt="Tour Photo <%= index + 1 %>"
                        loading="lazy"
                      />
                      <div class="slide-overlay">
                        <i class="fas fa-search-plus"></i>
                      </div>
                    </div>
                    <% }) %>
                  </div>
                </div>

                <!-- Slider Controls -->
                <div class="slider-controls">
                  <button class="slider-btn prev-btn" id="prevBtn">
                    <i class="fas fa-chevron-left"></i>
                  </button>
                  <button class="slider-btn next-btn" id="nextBtn">
                    <i class="fas fa-chevron-right"></i>
                  </button>
                </div>

                <!-- Slider Indicators -->
                <div class="slider-indicators" id="sliderIndicators">
                  <% for(let i = 0; i < Math.ceil(tour.moreImages.length / 3);
                  i++) { %>
                  <button
                    class="indicator-dot <%= i === 0 ? 'active' : '' %>"
                    data-slide="<%= i %>"
                  ></button>
                  <% } %>
                </div>

                <!-- Auto-play Control -->
                <div class="autoplay-control">
                  <button
                    class="autoplay-btn"
                    id="autoplayBtn"
                    title="Pause Slideshow"
                  >
                    <i class="fas fa-pause"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <% } %>

          <!-- Includes/Excludes -->
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">What's Included & Excluded</h2>
              <div class="includes-grid">
                <% if (tour.included && tour.included.length > 0) { %>
                <div class="includes-section included">
                  <h4 style="color: #27ae60; margin-bottom: 1.5rem">
                    <i class="fas fa-check-circle"></i> What's Included
                  </h4>
                  <ul class="includes-list">
                    <% tour.included.forEach(item => { %>
                    <li class="included"><%= item %></li>
                    <% }) %>
                  </ul>
                </div>
                <% } %> <% if (tour.excluded && tour.excluded.length > 0) { %>
                <div class="includes-section excluded">
                  <h4 style="color: #e74c3c; margin-bottom: 1.5rem">
                    <i class="fas fa-times-circle"></i> What's Not Included
                  </h4>
                  <ul class="includes-list">
                    <% tour.excluded.forEach(item => { %>
                    <li class="excluded"><%= item %></li>
                    <% }) %>
                  </ul>
                </div>
                <% } %>
              </div>
            </div>
          </div>

          <!-- Important Information -->
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Important Information</h2>
              <div class="row">
                <div class="col-md-6">
                  <h5 style="color: #2c3e50; margin-bottom: 1rem">
                    <i class="fas fa-exclamation-triangle"></i> Things to Bring
                  </h5>
                  <ul style="color: #6c757d; line-height: 1.8">
                    <li>Comfortable walking shoes</li>
                    <li>Sun protection (hat, sunscreen)</li>
                    <li>Camera for memories</li>
                    <li>Valid ID/Passport</li>
                    <li>Weather-appropriate clothing</li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <h5 style="color: #2c3e50; margin-bottom: 1rem">
                    <i class="fas fa-info-circle"></i> Additional Details
                  </h5>
                  <ul style="color: #6c757d; line-height: 1.8">
                    <li>
                      Age limit: <%= tour.ageRestriction || '5-80 years' %>
                    </li>
                    <li>Pickup available from city center</li>
                    <li>Free cancellation up to 24 hours</li>
                    <li>Professional guide included</li>
                    <li>Small group experience</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Reviews -->
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Reviews & Comments</h2>

              <% if (user) { %>
              <div class="comment-form">
                <h4
                  style="
                    margin-bottom: 1.5rem;
                    color: #2c3e50;
                    font-weight: 600;
                  "
                >
                  <i
                    class="fas fa-star"
                    style="color: #ffd700; margin-right: 0.5rem"
                  ></i>
                  Rate & Review This Tour
                </h4>

                <form
                  method="POST"
                  action="/tour/<%= tour.name.replace(/\s+/g, '-').toLowerCase() %>/comment"
                >
                  <!-- Star Rating Section -->
                  <div class="rating-section">
                    <label class="rating-label">Your Rating *</label>
                    <div class="star-rating-wrapper">
                      <div class="star-rating" id="starRating">
                        <span class="star" data-rating="1">â˜…</span>
                        <span class="star" data-rating="2">â˜…</span>
                        <span class="star" data-rating="3">â˜…</span>
                        <span class="star" data-rating="4">â˜…</span>
                        <span class="star" data-rating="5">â˜…</span>
                      </div>
                      <div class="rating-feedback">
                        <span class="rating-emoji">ðŸ˜Š</span>
                        <span class="rating-text">Click to rate</span>
                      </div>
                      <input
                        type="hidden"
                        name="rating"
                        id="ratingValue"
                        required
                      />
                    </div>
                  </div>

                  <!-- Review Text -->
                  <div class="form-group" style="margin-top: 2rem">
                    <label for="content" class="rating-label"
                      >Your Review *</label
                    >
                    <textarea
                      id="content"
                      name="content"
                      rows="4"
                      placeholder="Share your experience about this tour..."
                      style="
                        width: 100%;
                        padding: 1rem;
                        border: 2px solid #e5e7eb;
                        border-radius: 8px;
                        font-size: 1rem;
                        line-height: 1.5;
                        resize: vertical;
                        font-family: inherit;
                        transition: border-color 0.3s ease;
                      "
                      required
                    ></textarea>
                  </div>

                  <button
                    type="submit"
                    class="submit-review-btn"
                    disabled
                    id="submitBtn"
                  >
                    <i class="fas fa-paper-plane"></i>
                    Post Your Review
                  </button>
                </form>
              </div>
              <% } %> <% if (comments && comments.length > 0) { %> <%
              comments.forEach(comment => { %>
              <div class="review-item">
                <div class="review-header">
                  <div class="reviewer-avatar">
                    <%= comment.createdBy.fullName.charAt(0).toUpperCase() %>
                  </div>
                  <div>
                    <h5 style="margin: 0; color: #2c3e50; font-weight: 600">
                      <%= comment.createdBy.fullName %>
                    </h5>
                    <small class="text-muted" style="color: #6b7280">
                      <i class="far fa-calendar"></i>
                      <%= new
                      Date(comment.createdAt).toLocaleDateString('en-US', {
                      year: 'numeric', month: 'long', day: 'numeric' }) %>
                    </small>
                  </div>
                  <div class="review-stars">
                    <% for(let i = 1; i <= 5; i++) { %>
                    <span
                      class="star <%= comment.rating >= i ? 'filled' : '' %>"
                      >â˜…</span
                    >
                    <% } %>
                    <span class="review-rating-emoji">
                      <%= comment.rating === 5 ? 'ðŸ¤©' : comment.rating === 4 ?
                      'ðŸ˜Š' : comment.rating === 3 ? 'ðŸ™‚' : comment.rating === 2
                      ? 'ðŸ˜' : 'ðŸ˜ž' %>
                    </span>
                  </div>
                </div>
                <p style="line-height: 1.7; color: #374151; margin: 0">
                  <%= comment.content %>
                </p>
              </div>
              <% }) %> <% } else { %>
              <div style="text-align: center; padding: 3rem; color: #6c757d">
                <i
                  class="far fa-comments"
                  style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5"
                ></i>
                <p style="font-size: 1.1rem">
                  No reviews yet. Be the first to share your experience!
                </p>
              </div>
              <% } %>
            </div>
          </div>
        </div>

        <!-- Sidebar - UPDATED -->
        <div class="col-lg-4">
          <div class="booking-sidebar">
            <!-- Price Card -->
            <div class="price-card">
              <div class="price">
                â‚¹<%= tour.price.toLocaleString('en-IN') %>
              </div>
              <div class="price-per">per person</div>

              <!-- Book Now Button (Always enabled) -->
              <button
                class="btn-book"
                onclick="proceedToBooking()"
                style="margin-top: 2rem"
              >
                <i
                  class="fas fa-calendar-check"
                  style="margin-right: 0.5rem"
                ></i>
                Book Now
              </button>

              <button
                class="btn-book"
                onclick="bookTour()"
                style="
                  margin-top: 1rem;
                  background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
                "
              >
                <i class="fas fa-envelope" style="margin-right: 0.5rem"></i>
                Enquire Now
              </button>

              <div
                style="
                  margin-top: 1.5rem;
                  font-size: 0.9rem;
                  opacity: 0.8;
                  text-align: center;
                "
              >
                <i class="fas fa-shield-alt" style="margin-right: 0.5rem"></i>
                100% Safe & Secure Booking
              </div>
            </div>

            <!-- Tour Guide Info -->
            <% if (tour.guides && tour.guides.length > 0) { %>
            <div class="tour-card">
              <div class="card-content">
                <h4 style="margin-bottom: 1.5rem; color: #2c3e50">
                  <i class="fas fa-user-tie"></i> Your Tour Guide
                </h4>
                <% tour.guides.forEach(guide => { %>
                <div
                  style="
                    display: flex;
                    align-items: center;
                    margin-bottom: 1rem;
                  "
                >
                  <div
                    style="
                      width: 60px;
                      height: 60px;
                      border-radius: 50%;
                      background: linear-gradient(135deg, #667eea, #764ba2);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      color: white;
                      font-weight: 600;
                      margin-right: 1rem;
                    "
                  >
                    <%= guide.name.charAt(0).toUpperCase() %>
                  </div>
                  <div>
                    <h5 style="margin: 0; color: #2c3e50"><%= guide.name %></h5>
                    <p style="margin: 0; color: #6c757d; font-size: 0.9rem">
                      <%= guide.role || 'Professional Guide' %>
                    </p>
                    <div style="color: #ffd700; font-size: 0.8rem">
                      <% for(let i = 1; i <= 5; i++) { %>
                      <i class="fas fa-star"></i>
                      <% } %>
                    </div>
                  </div>
                </div>
                <% }) %>
              </div>
            </div>
            <% } %>

            <!-- Contact Card -->
            <div class="tour-card">
              <div class="card-content">
                <h4 style="margin-bottom: 1.5rem; color: #2c3e50">
                  <i class="fas fa-headset"></i> Need Help?
                </h4>
                <div style="margin-bottom: 1rem">
                  <p style="margin-bottom: 0.5rem; color: #6c757d">
                    <i
                      class="fas fa-phone"
                      style="color: #667eea; margin-right: 0.5rem"
                    ></i>
                    <strong>Call Us:</strong>
                  </p>
                  <p style="color: #2c3e50; font-size: 1.1rem">
                    +91 98765 43210
                  </p>
                </div>
                <div style="margin-bottom: 1rem">
                  <p style="margin-bottom: 0.5rem; color: #6c757d">
                    <i
                      class="fas fa-envelope"
                      style="color: #667eea; margin-right: 0.5rem"
                    ></i>
                    <strong>Email:</strong>
                  </p>
                  <p style="color: #2c3e50">orbitrushtourism@gmail.com</p>
                </div>
                <div>
                  <p style="margin-bottom: 0.5rem; color: #6c757d">
                    <i
                      class="fas fa-clock"
                      style="color: #667eea; margin-right: 0.5rem"
                    ></i>
                    <strong>Support Hours:</strong>
                  </p>
                  <p style="color: #2c3e50">24/7 Customer Support</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include("partials/scripts") %>

    <script>
      // Toggle show more/less dates
      function toggleDates() {
        const hiddenDates = document.getElementById("hiddenDates");
        const btn = document.getElementById("showMoreBtn");
        const btnText = document.getElementById("btnText");
        const btnIcon = document.getElementById("btnIcon");

        if (hiddenDates.style.display === "none") {
          hiddenDates.style.display = "grid";
          btnText.textContent = "Show Less";
          btn.classList.add("expanded");
        } else {
          hiddenDates.style.display = "none";
          const totalHidden = document.querySelectorAll(
            "#hiddenDates .date-badge"
          ).length;
          btnText.textContent = `Show All Dates (${totalHidden} more)`;
          btn.classList.remove("expanded");
        }
      }

      // Simplified booking function - goes directly to booking page
      function proceedToBooking() {
        // Redirect to booking page with tour ID
        window.location.href = `/booking/book/<%= tour._id %>`;
      }

      function bookTour() {
        window.location.href = "/tour/enquire";
      }

      document.addEventListener("DOMContentLoaded", function () {
        const stars = document.querySelectorAll(".star");
        const ratingValue = document.getElementById("ratingValue");
        const ratingEmoji = document.querySelector(".rating-emoji");
        const ratingText = document.querySelector(".rating-text");
        const submitBtn = document.getElementById("submitBtn");

        const ratingData = {
          1: { emoji: "ðŸ˜ž", text: "Terrible" },
          2: { emoji: "ðŸ˜", text: "Poor" },
          3: { emoji: "ðŸ™‚", text: "Average" },
          4: { emoji: "ðŸ˜Š", text: "Good" },
          5: { emoji: "ðŸ¤©", text: "Excellent" },
        };

        let currentRating = 0;

        function updateStars(rating, isHover = false) {
          stars.forEach((star, index) => {
            const starRating = parseInt(star.dataset.rating);
            star.classList.remove("active", "selected");

            if (starRating <= rating) {
              star.classList.add(isHover ? "active" : "selected");
            }
          });
        }

        function updateFeedback(rating) {
          if (rating > 0 && ratingData[rating]) {
            ratingEmoji.textContent = ratingData[rating].emoji;
            ratingText.textContent = ratingData[rating].text;
            ratingEmoji.style.transform = "scale(1.2)";
            setTimeout(() => {
              ratingEmoji.style.transform = "scale(1)";
            }, 200);
          }
        }

        // Star click events
        stars.forEach((star) => {
          star.addEventListener("click", function () {
            currentRating = parseInt(this.dataset.rating);
            ratingValue.value = currentRating;
            updateStars(currentRating);
            updateFeedback(currentRating);
            submitBtn.disabled = false;
          });

          star.addEventListener("mouseenter", function () {
            const hoverRating = parseInt(this.dataset.rating);
            updateStars(hoverRating, true);
            updateFeedback(hoverRating);
          });
        });

        // Reset on mouse leave
        document
          .querySelector(".star-rating")
          .addEventListener("mouseleave", function () {
            updateStars(currentRating);
            if (currentRating > 0) {
              updateFeedback(currentRating);
            } else {
              ratingEmoji.textContent = "ðŸ˜Š";
              ratingText.textContent = "Click to rate";
            }
          });
      });

      // Gallery Slider
      let currentSlide = 0;
      let totalSlides = 0;
      let autoPlayInterval;

      function initGallerySlider() {
        const sliderTrack = document.getElementById("sliderTrack");
        const slides = document.querySelectorAll(".slide-item");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const indicators = document.querySelectorAll(".indicator-dot");
        const autoplayBtn = document.getElementById("autoplayBtn");

        if (!sliderTrack || slides.length === 0) return;

        totalSlides = Math.ceil(slides.length / 3);

        if (prevBtn) {
          prevBtn.addEventListener("click", () => {
            currentSlide =
              currentSlide === 0 ? totalSlides - 1 : currentSlide - 1;
            updateSlider();
          });
        }

        if (nextBtn) {
          nextBtn.addEventListener("click", () => {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateSlider();
          });
        }

        indicators.forEach((dot, index) => {
          dot.addEventListener("click", () => {
            currentSlide = index;
            updateSlider();
          });
        });

        if (autoplayBtn) {
          autoplayBtn.addEventListener("click", () => {
            if (autoPlayInterval) {
              clearInterval(autoPlayInterval);
              autoPlayInterval = null;
              autoplayBtn.querySelector("i").className = "fas fa-play";
              autoplayBtn.title = "Play Slideshow";
            } else {
              startAutoPlay();
              autoplayBtn.querySelector("i").className = "fas fa-pause";
              autoplayBtn.title = "Pause Slideshow";
            }
          });
        }

        startAutoPlay();

        sliderTrack.addEventListener("mouseenter", () => {
          if (autoPlayInterval) {
            clearInterval(autoPlayInterval);
          }
        });

        sliderTrack.addEventListener("mouseleave", () => {
          startAutoPlay();
        });
      }

      function updateSlider() {
        const sliderTrack = document.getElementById("sliderTrack");
        const indicators = document.querySelectorAll(".indicator-dot");

        if (!sliderTrack) return;

        const translateX = -(currentSlide * 100);
        sliderTrack.style.transform = `translateX(${translateX}%)`;

        indicators.forEach((dot, index) => {
          if (index === currentSlide) {
            dot.classList.add("active");
          } else {
            dot.classList.remove("active");
          }
        });
      }

      function startAutoPlay() {
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
        }

        autoPlayInterval = setInterval(() => {
          currentSlide = (currentSlide + 1) % totalSlides;
          updateSlider();
        }, 4000);
      }

      document.addEventListener("DOMContentLoaded", function () {
        if (document.getElementById("gallerySlider")) {
          initGallerySlider();
        }

        const observerOptions = {
          threshold: 0.1,
          rootMargin: "0px 0px -50px 0px",
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.style.opacity = "1";
              entry.target.style.transform = "translateY(0)";
            }
          });
        }, observerOptions);

        document.querySelectorAll(".tour-card").forEach((card) => {
          card.style.opacity = "0";
          card.style.transform = "translateY(30px)";
          card.style.transition = "opacity 0.6s ease, transform 0.6s ease";
          observer.observe(card);
        });
      });

      // Smooth scrolling
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute("href"));
          if (target) {
            target.scrollIntoView({ behavior: "smooth" });
          }
        });
      });
    </script>
  </body>
</html>
