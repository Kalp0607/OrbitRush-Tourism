<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= tour.name %> | OrbitRush Tourism</title>
    <%- include("partials/head") %>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #f8f9fa;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        line-height: 1.6;
      }

      /* Hero Section - FIXED */
      .hero-section {
        background: linear-gradient(
            135deg,
            rgba(0, 0, 0, 0.6),
            rgba(0, 0, 0, 0.3)
          ),
          url("<%= tour.coverImage %>");
        background-size: cover;
        background-position: center;
        height: 70vh; /* Increased height */
        display: flex;
        align-items: center;
        color: white;
        position: relative;
        overflow: hidden;
        padding: 2rem 0; /* Added padding */
      }

      .hero-content {
        position: relative;
        z-index: 2;
        width: 100%;
      }

      .hero-section h1 {
        font-size: 3.5rem;
        font-weight: 700;
        margin-bottom: 1.5rem; /* Increased margin */
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        line-height: 1.2; /* Added line height */
      }

      .hero-location {
        font-size: 1.3rem;
        margin-bottom: 2rem; /* Increased margin */
        opacity: 0.9;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .hero-tags {
        display: flex;
        gap: 1.5rem; /* Increased gap */
        flex-wrap: wrap;
        justify-content: flex-start;
        align-items: center;
        margin-top: 1rem; /* Added top margin */
      }

      .hero-tag {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        padding: 0.8rem 1.2rem; /* Increased padding */
        border-radius: 25px;
        font-size: 0.95rem; /* Slightly increased font size */
        border: 1px solid rgba(255, 255, 255, 0.3);
        white-space: nowrap; /* Prevent text wrapping inside tags */
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
        margin-bottom: 0.5rem; /* Added bottom margin for wrapped items */
      }

      .hero-tag:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      .hero-tag i {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      /* Responsive fixes for hero section */
      @media (max-width: 1200px) {
        .hero-section {
          height: 75vh; /* More height on medium screens */
        }

        .hero-section h1 {
          font-size: 3rem;
          margin-bottom: 1.2rem;
        }

        .hero-location {
          font-size: 1.2rem;
          margin-bottom: 1.8rem;
        }

        .hero-tag {
          font-size: 0.9rem;
          padding: 0.7rem 1rem;
        }
      }

      @media (max-width: 992px) {
        .hero-section {
          height: 80vh; /* Even more height on tablets */
          padding: 3rem 0;
        }

        .hero-section h1 {
          font-size: 2.8rem;
        }

        .hero-tags {
          gap: 1rem;
          justify-content: center; /* Center tags on tablet */
        }
      }

      @media (max-width: 768px) {
        .hero-section {
          height: 85vh; /* Maximum height on mobile */
          padding: 2rem 0;
          text-align: center;
        }

        .hero-section h1 {
          font-size: 2.5rem;
          margin-bottom: 1rem;
        }

        .hero-location {
          font-size: 1.1rem;
          margin-bottom: 1.5rem;
          justify-content: center;
        }

        .hero-tags {
          gap: 0.8rem;
          justify-content: center;
          flex-direction: row; /* Keep horizontal on mobile */
        }

        .hero-tag {
          font-size: 0.85rem;
          padding: 0.6rem 0.9rem;
        }
      }

      @media (max-width: 480px) {
        .hero-section {
          height: 90vh; /* Maximum height for small phones */
        }

        .hero-section h1 {
          font-size: 2rem;
        }

        .hero-tags {
          gap: 0.5rem;
          flex-direction: column; /* Stack vertically on very small screens */
          align-items: center;
        }

        .hero-tag {
          font-size: 0.8rem;
          padding: 0.5rem 0.8rem;
          min-width: 200px; /* Consistent width when stacked */
          justify-content: center;
        }
      }

      /* Main Content */
      .main-content {
        margin-top: -100px;
        position: relative;
        z-index: 3;
      }

      .tour-card {
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .tour-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      }

      .card-content {
        padding: 2.5rem;
      }

      /* Booking Section */
      .booking-sidebar {
        position: sticky;
        top: 2rem;
      }

      .price-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 20px;
        padding: 2.5rem;
        text-align: center;
        margin-bottom: 2rem;
      }

      .price {
        font-size: 3rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
      }

      .price-per {
        opacity: 0.8;
        font-size: 1.1rem;
      }

      .btn-book {
        background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
        color: white;
        padding: 1.2rem 2.5rem;
        border: none;
        border-radius: 50px;
        font-size: 1.2rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        width: 100%;
        margin-top: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .btn-book:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(255, 107, 53, 0.4);
      }

      /* Quick Info Cards */
      .quick-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .info-item {
        background: white;
        padding: 1.5rem;
        border-radius: 15px;
        text-align: center;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        transition: transform 0.3s ease;
      }

      .info-item:hover {
        transform: translateY(-3px);
      }

      .info-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      /* Sections */
      .section-title {
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        color: #2c3e50;
        position: relative;
        padding-bottom: 0.5rem;
      }

      .section-title::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 60px;
        height: 4px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        border-radius: 2px;
      }

      /* Itinerary */
      .itinerary-day {
        background: #f8f9fa;
        border-left: 4px solid #667eea;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        border-radius: 0 10px 10px 0;
        position: relative;
      }

      .itinerary-day::before {
        content: "";
        position: absolute;
        left: -8px;
        top: 1.5rem;
        width: 16px;
        height: 16px;
        background: #667eea;
        border-radius: 50%;
      }

      .day-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 0.5rem;
      }

      /* Gallery */
      .gallery-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .gallery-item {
        position: relative;
        overflow: hidden;
        border-radius: 15px;
        aspect-ratio: 4/3;
      }

      .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
      }

      .gallery-item:hover img {
        transform: scale(1.1);
      }

      /* Includes/Excludes */
      .includes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
      }

      .includes-section {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      }

      .includes-section.included {
        border-left: 4px solid #27ae60;
      }

      .includes-section.excluded {
        border-left: 4px solid #e74c3c;
      }

      .includes-list {
        list-style: none;
        padding: 0;
      }

      .includes-list li {
        padding: 0.75rem 0;
        border-bottom: 1px solid #eee;
        position: relative;
        padding-left: 2rem;
      }

      .includes-list li:last-child {
        border-bottom: none;
      }

      .includes-list li::before {
        position: absolute;
        left: 0;
        top: 0.9rem;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        color: white;
        font-size: 0.8rem;
        text-align: center;
        line-height: 16px;
      }

      .included li::before {
        content: "✓";
        background: #27ae60;
      }

      .excluded li::before {
        content: "✗";
        background: #e74c3c;
      }

      /* Reviews */
      .review-item {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        margin-bottom: 1.5rem;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      }

      .review-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
      }

      .reviewer-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        margin-right: 1rem;
      }

      .rating-stars {
        color: #ffd700;
        margin-left: auto;
      }

      /* Form */
      .comment-form {
        background: white;
        padding: 2rem;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        margin-bottom: 2rem;
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .form-control {
        width: 100%;
        padding: 1rem;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .form-control:focus {
        outline: none;
        border-color: #667eea;
      }

      /* Gallery Slider Styles */
      .gallery-slider-container {
        position: relative;
        margin-top: 1rem;
        background: #f8f9fa;
        border-radius: 15px;
        padding: 1rem;
        overflow: hidden;
      }

      .gallery-slider {
        position: relative;
        overflow: hidden;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .slider-track {
        display: flex;
        transition: transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        gap: 1rem;
        padding: 0.5rem;
      }

      .slide-item {
        flex: 0 0 calc(33.333% - 0.67rem);
        position: relative;
        border-radius: 10px;
        overflow: hidden;
        aspect-ratio: 4/3;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .slide-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .slide-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
      }

      .slide-item:hover img {
        transform: scale(1.05);
      }

      .slide-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .slide-item:hover .slide-overlay {
        opacity: 1;
      }

      .slide-overlay i {
        color: white;
        font-size: 2rem;
      }

      /* Slider Controls */
      .slider-controls {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        transform: translateY(-50%);
        display: flex;
        justify-content: space-between;
        pointer-events: none;
        z-index: 2;
      }

      .slider-btn {
        background: rgba(255, 255, 255, 0.9);
        border: none;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        pointer-events: all;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        margin: 0 1rem;
      }

      .slider-btn:hover {
        background: white;
        transform: scale(1.1);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .slider-btn i {
        color: #333;
        font-size: 1.2rem;
      }

      /* Slider Indicators */
      .slider-indicators {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 1.5rem;
      }

      .indicator-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: none;
        background: #ccc;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .indicator-dot.active {
        background: linear-gradient(135deg, #667eea, #764ba2);
        transform: scale(1.2);
      }

      .indicator-dot:hover {
        background: #999;
        transform: scale(1.1);
      }

      /* Auto-play Control */
      .autoplay-control {
        position: absolute;
        top: 1rem;
        right: 1rem;
        z-index: 3;
      }

      .autoplay-btn {
        background: rgba(0, 0, 0, 0.7);
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .autoplay-btn:hover {
        background: rgba(0, 0, 0, 0.9);
        transform: scale(1.1);
      }

      .autoplay-btn i {
        color: white;
        font-size: 1rem;
      }
      /* Gallery Slider Fix */
      .slider-track {
        display: flex;
        transition: transform 0.5s ease-in-out; /* Simplified transition */
        gap: 1rem;
        padding: 0.5rem;
        width: 100%; /* Ensure full width */
      }

      .slide-item {
        flex: 0 0 calc(33.333% - 0.67rem);
        position: relative;
        border-radius: 10px;
        overflow: hidden;
        aspect-ratio: 4/3;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        min-width: 0; /* Prevent flex shrinking issues */
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .slide-item {
          flex: 0 0 calc(50% - 0.5rem);
        }

        .slider-btn {
          width: 40px;
          height: 40px;
          margin: 0 0.5rem;
        }

        .slider-btn i {
          font-size: 1rem;
        }
      }

      @media (max-width: 480px) {
        .slide-item {
          flex: 0 0 100%;
        }

        .slider-track {
          gap: 0.5rem;
        }
      }

      /* Loading Animation */
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .slide-item {
        animation: slideIn 0.6s ease;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .hero-section h1 {
          font-size: 2.5rem;
        }

        .main-content {
          margin-top: -50px;
        }

        .card-content {
          padding: 1.5rem;
        }

        .price {
          font-size: 2.5rem;
        }
      }

      /* Animations */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .tour-card {
        animation: fadeInUp 0.6s ease;
      }

      .tour-card:nth-child(even) {
        animation-delay: 0.2s;
      }
    </style>
  </head>
  <body>
    <%- include("partials/nav") %>

    <!-- Hero Section -->
    <div class="hero-section">
      <div class="container">
        <div class="hero-content">
          <h1><%= tour.name %></h1>
          <p class="hero-location">
            <i class="fas fa-map-marker-alt"></i> <%= tour.location %>
          </p>
          <div class="hero-tags">
            <span class="hero-tag">
              <i class="far fa-clock"></i> <%= tour.duration %>
            </span>
            <span class="hero-tag">
              <i class="fas fa-users"></i> Max <%= tour.maxGroupSize || '20' %>
              People
            </span>
            <span class="hero-tag">
              <i class="fas fa-star"></i> <%= tour.ratingsAverage || '4.5' %>
              Rating
            </span>
          </div>
        </div>
      </div>
    </div>

    <div class="container main-content">
      <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
          <!-- Quick Info -->
          <div class="quick-info">
            <div class="info-item">
              <div class="info-icon">
                <i class="far fa-calendar"></i>
              </div>
              <h4>Duration</h4>
              <p><%= tour.duration %></p>
            </div>
            <div class="info-item">
              <div class="info-icon">
                <i class="fas fa-signal"></i>
              </div>
              <h4>Difficulty</h4>
              <p><%= tour.difficulty || 'Moderate' %></p>
            </div>
            <div class="info-item">
              <div class="info-icon">
                <i class="fas fa-users"></i>
              </div>
              <h4>Group Size</h4>
              <p>Max <%= tour.maxGroupSize || '20' %></p>
            </div>
            <div class="info-item">
              <div class="info-icon">
                <i class="fas fa-map-marked-alt"></i>
              </div>
              <h4>Start Location</h4>
              <p><%= tour.startLocation || tour.location %></p>
            </div>
          </div>

          <!-- Tour Overview -->
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Tour Overview</h2>
              <p style="font-size: 1.1rem; color: #6c757d; line-height: 1.8">
                <%= tour.overview %>
              </p>
            </div>
          </div>

          <!-- Tour Highlights -->
          <% if (tour.highlights && tour.highlights.length > 0) { %>
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Tour Highlights</h2>
              <div class="row">
                <% tour.highlights.forEach(highlight => { %>
                <div class="col-md-6 mb-3">
                  <div style="display: flex; align-items: center">
                    <i
                      class="fas fa-check-circle"
                      style="
                        color: #27ae60;
                        margin-right: 1rem;
                        font-size: 1.2rem;
                      "
                    ></i>
                    <span style="font-size: 1.1rem"><%= highlight %></span>
                  </div>
                </div>
                <% }) %>
              </div>
            </div>
          </div>
          <% } %>

          <!-- Itinerary -->
          <% if (tour.itinerary && tour.itinerary.length > 0) { %>
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Day-by-Day Itinerary</h2>
              <% tour.itinerary.forEach((day, index) => { %>
              <div class="itinerary-day">
                <h4 class="day-title">
                  Day <%= index + 1 %>: <%= day.title %>
                </h4>
                <p style="color: #6c757d; margin-bottom: 0.5rem">
                  <i class="far fa-clock"></i> <%= day.time || 'Full Day' %>
                </p>
                <p style="line-height: 1.7"><%= day.description %></p>
              </div>
              <% }) %>
            </div>
          </div>
          <% } %>

          <!-- Gallery -->
          <% if (tour.moreImages && tour.moreImages.length > 0) { %>
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Photo Gallery</h2>
              <div class="gallery-slider-container">
                <div class="gallery-slider" id="gallerySlider">
                  <div class="slider-track" id="sliderTrack">
                    <% tour.moreImages.forEach((image, index) => { %>
                    <div class="slide-item">
                      <img
                        src="<%= image %>"
                        alt="Tour Photo <%= index + 1 %>"
                        loading="lazy"
                      />
                      <div class="slide-overlay">
                        <i class="fas fa-search-plus"></i>
                      </div>
                    </div>
                    <% }) %>
                  </div>
                </div>

                <!-- Slider Controls -->
                <div class="slider-controls">
                  <button class="slider-btn prev-btn" id="prevBtn">
                    <i class="fas fa-chevron-left"></i>
                  </button>
                  <button class="slider-btn next-btn" id="nextBtn">
                    <i class="fas fa-chevron-right"></i>
                  </button>
                </div>

                <!-- Slider Indicators -->
                <div class="slider-indicators" id="sliderIndicators">
                  <% for(let i = 0; i < Math.ceil(tour.moreImages.length / 3);
                  i++) { %>
                  <button
                    class="indicator-dot <%= i === 0 ? 'active' : '' %>"
                    data-slide="<%= i %>"
                  ></button>
                  <% } %>
                </div>

                <!-- Auto-play Control -->
                <div class="autoplay-control">
                  <button
                    class="autoplay-btn"
                    id="autoplayBtn"
                    title="Pause Slideshow"
                  >
                    <i class="fas fa-pause"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <% } %>

          <!-- Includes/Excludes -->
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">What's Included & Excluded</h2>
              <div class="includes-grid">
                <% if (tour.included && tour.included.length > 0) { %>
                <div class="includes-section included">
                  <h4 style="color: #27ae60; margin-bottom: 1.5rem">
                    <i class="fas fa-check-circle"></i> What's Included
                  </h4>
                  <ul class="includes-list">
                    <% tour.included.forEach(item => { %>
                    <li class="included"><%= item %></li>
                    <% }) %>
                  </ul>
                </div>
                <% } %> <% if (tour.excluded && tour.excluded.length > 0) { %>
                <div class="includes-section excluded">
                  <h4 style="color: #e74c3c; margin-bottom: 1.5rem">
                    <i class="fas fa-times-circle"></i> What's Not Included
                  </h4>
                  <ul class="includes-list">
                    <% tour.excluded.forEach(item => { %>
                    <li class="excluded"><%= item %></li>
                    <% }) %>
                  </ul>
                </div>
                <% } %>
              </div>
            </div>
          </div>

          <!-- Important Information -->
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Important Information</h2>
              <div class="row">
                <div class="col-md-6">
                  <h5 style="color: #2c3e50; margin-bottom: 1rem">
                    <i class="fas fa-exclamation-triangle"></i> Things to Bring
                  </h5>
                  <ul style="color: #6c757d; line-height: 1.8">
                    <li>Comfortable walking shoes</li>
                    <li>Sun protection (hat, sunscreen)</li>
                    <li>Camera for memories</li>
                    <li>Valid ID/Passport</li>
                    <li>Weather-appropriate clothing</li>
                  </ul>
                </div>
                <div class="col-md-6">
                  <h5 style="color: #2c3e50; margin-bottom: 1rem">
                    <i class="fas fa-info-circle"></i> Additional Details
                  </h5>
                  <ul style="color: #6c757d; line-height: 1.8">
                    <li>
                      Age limit: <%= tour.ageRestriction || '5-80 years' %>
                    </li>
                    <li>Pickup available from city center</li>
                    <li>Free cancellation up to 24 hours</li>
                    <li>Professional guide included</li>
                    <li>Small group experience</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Reviews -->
          <div class="tour-card">
            <div class="card-content">
              <h2 class="section-title">Reviews & Comments</h2>

              <% if (user) { %>
              <div class="comment-form">
                <h4 style="margin-bottom: 1.5rem; color: #2c3e50">
                  Share Your Experience
                </h4>
                <form
                  method="POST"
                  action="/tour/<%= tour.name.replace(/\s+/g, '-').toLowerCase() %>/comment"
                >
                  <div class="form-group">
                    <textarea
                      class="form-control"
                      name="content"
                      rows="4"
                      placeholder="Tell us about your experience..."
                      style="resize: vertical"
                    ></textarea>
                  </div>
                  <button
                    type="submit"
                    class="btn btn-primary"
                    style="
                      background: linear-gradient(135deg, #667eea, #764ba2);
                      border: none;
                      padding: 0.8rem 2rem;
                      border-radius: 25px;
                    "
                  >
                    <i class="fas fa-paper-plane"></i> Post Review
                  </button>
                </form>
              </div>
              <% } %> <% if (comments && comments.length > 0) { %> <%
              comments.forEach(comment => { %>
              <div class="review-item">
                <div class="review-header">
                  <div class="reviewer-avatar">
                    <%= comment.createdBy.fullName.charAt(0).toUpperCase() %>
                  </div>
                  <div>
                    <h5 style="margin: 0; color: #2c3e50">
                      <%= comment.createdBy.fullName %>
                    </h5>
                    <small class="text-muted">
                      <i class="far fa-calendar"></i>
                      <%= new
                      Date(comment.createdAt).toLocaleDateString('en-US', {
                      year: 'numeric', month: 'long', day: 'numeric' }) %>
                    </small>
                  </div>
                  <div class="rating-stars">
                    <% for(let i = 1; i <= 5; i++) { %>
                    <i class="fas fa-star"></i>
                    <% } %>
                  </div>
                </div>
                <p style="line-height: 1.7; color: #495057">
                  <%= comment.content %>
                </p>
              </div>
              <% }) %> <% } else { %>
              <div style="text-align: center; padding: 3rem; color: #6c757d">
                <i
                  class="far fa-comments"
                  style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5"
                ></i>
                <p style="font-size: 1.1rem">
                  No reviews yet. Be the first to share your experience!
                </p>
              </div>
              <% } %>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
          <div class="booking-sidebar">
            <!-- Price Card -->
            <div class="price-card">
              <div class="price">₹<%= tour.price.toLocaleString() %></div>
              <p class="price-per">per person</p>
              <div
                style="
                  margin: 1.5rem 0;
                  padding: 1rem 0;
                  border-top: 1px solid rgba(255, 255, 255, 0.2);
                  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                "
              >
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 0.5rem;
                  "
                >
                  <span>Base Price:</span>
                  <span>₹<%= tour.price.toLocaleString() %></span>
                </div>
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    font-size: 0.9rem;
                    opacity: 0.8;
                  "
                >
                  <span>Service Fee:</span>
                  <span>Included</span>
                </div>
              </div>
              <button class="btn-book" onclick="bookTour()">
                <i class="fas fa-envelope"></i> Enquire Now
              </button>

              <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 1rem">
                <i class="fas fa-shield-alt"></i> Free cancellation up to 24
                hours before
              </p>
            </div>

            <!-- Tour Guide Info -->
            <% if (tour.guides && tour.guides.length > 0) { %>
            <div class="tour-card">
              <div class="card-content">
                <h4 style="margin-bottom: 1.5rem; color: #2c3e50">
                  <i class="fas fa-user-tie"></i> Your Tour Guide
                </h4>
                <% tour.guides.forEach(guide => { %>
                <div
                  style="
                    display: flex;
                    align-items: center;
                    margin-bottom: 1rem;
                  "
                >
                  <div
                    style="
                      width: 60px;
                      height: 60px;
                      border-radius: 50%;
                      background: linear-gradient(135deg, #667eea, #764ba2);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      color: white;
                      font-weight: 600;
                      margin-right: 1rem;
                    "
                  >
                    <%= guide.name.charAt(0).toUpperCase() %>
                  </div>
                  <div>
                    <h5 style="margin: 0; color: #2c3e50"><%= guide.name %></h5>
                    <p style="margin: 0; color: #6c757d; font-size: 0.9rem">
                      <%= guide.role || 'Professional Guide' %>
                    </p>
                    <div style="color: #ffd700; font-size: 0.8rem">
                      <% for(let i = 1; i <= 5; i++) { %>
                      <i class="fas fa-star"></i>
                      <% } %>
                    </div>
                  </div>
                </div>
                <% }) %>
              </div>
            </div>
            <% } %>

            <!-- Contact Card -->
            <div class="tour-card">
              <div class="card-content">
                <h4 style="margin-bottom: 1.5rem; color: #2c3e50">
                  <i class="fas fa-headset"></i> Need Help?
                </h4>
                <div style="margin-bottom: 1rem">
                  <p style="margin-bottom: 0.5rem; color: #6c757d">
                    <i
                      class="fas fa-phone"
                      style="color: #667eea; margin-right: 0.5rem"
                    ></i>
                    <strong>Call Us:</strong>
                  </p>
                  <p style="color: #2c3e50; font-size: 1.1rem">
                    +91 98765 43210
                  </p>
                </div>
                <div style="margin-bottom: 1rem">
                  <p style="margin-bottom: 0.5rem; color: #6c757d">
                    <i
                      class="fas fa-envelope"
                      style="color: #667eea; margin-right: 0.5rem"
                    ></i>
                    <strong>Email:</strong>
                  </p>
                  <p style="color: #2c3e50">orbitrushtourism@gmail.com</p>
                </div>
                <div>
                  <p style="margin-bottom: 0.5rem; color: #6c757d">
                    <i
                      class="fas fa-clock"
                      style="color: #667eea; margin-right: 0.5rem"
                    ></i>
                    <strong>Support Hours:</strong>
                  </p>
                  <p style="color: #2c3e50">24/7 Customer Support</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%- include("partials/scripts") %>

    <script>
      function bookTour() {
        window.location.href = "/tour/enquire";
      }

      // Simple Gallery Slider that actually works
      let currentSlide = 0;
      let totalSlides = 0;
      let autoPlayInterval;

      function initGallerySlider() {
        const sliderTrack = document.getElementById("sliderTrack");
        const slides = document.querySelectorAll(".slide-item");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const indicators = document.querySelectorAll(".indicator-dot");
        const autoplayBtn = document.getElementById("autoplayBtn");

        if (!sliderTrack || slides.length === 0) return;

        // Calculate total slides (3 images per slide)
        totalSlides = Math.ceil(slides.length / 3);

        // Navigation buttons
        if (prevBtn) {
          prevBtn.addEventListener("click", () => {
            currentSlide =
              currentSlide === 0 ? totalSlides - 1 : currentSlide - 1;
            updateSlider();
          });
        }

        if (nextBtn) {
          nextBtn.addEventListener("click", () => {
            currentSlide = (currentSlide + 1) % totalSlides;
            updateSlider();
          });
        }

        // Indicator dots
        indicators.forEach((dot, index) => {
          dot.addEventListener("click", () => {
            currentSlide = index;
            updateSlider();
          });
        });

        // Auto-play toggle
        if (autoplayBtn) {
          autoplayBtn.addEventListener("click", () => {
            if (autoPlayInterval) {
              clearInterval(autoPlayInterval);
              autoPlayInterval = null;
              autoplayBtn.querySelector("i").className = "fas fa-play";
              autoplayBtn.title = "Play Slideshow";
            } else {
              startAutoPlay();
              autoplayBtn.querySelector("i").className = "fas fa-pause";
              autoplayBtn.title = "Pause Slideshow";
            }
          });
        }

        // Start auto-play
        startAutoPlay();

        // Pause on hover
        sliderTrack.addEventListener("mouseenter", () => {
          if (autoPlayInterval) {
            clearInterval(autoPlayInterval);
          }
        });

        sliderTrack.addEventListener("mouseleave", () => {
          startAutoPlay();
        });

        console.log("✅ Gallery slider initialized successfully!");
      }

      function updateSlider() {
        const sliderTrack = document.getElementById("sliderTrack");
        const indicators = document.querySelectorAll(".indicator-dot");

        if (!sliderTrack) return;

        // Move the slider
        const translateX = -(currentSlide * 100);
        sliderTrack.style.transform = `translateX(${translateX}%)`;

        // Update indicators
        indicators.forEach((dot, index) => {
          if (index === currentSlide) {
            dot.classList.add("active");
          } else {
            dot.classList.remove("active");
          }
        });

        console.log(`Moved to slide ${currentSlide + 1} of ${totalSlides}`);
      }

      function startAutoPlay() {
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
        }

        autoPlayInterval = setInterval(() => {
          currentSlide = (currentSlide + 1) % totalSlides;
          updateSlider();
        }, 4000); // Change slide every 4 seconds
      }

      // Initialize when page loads
      document.addEventListener("DOMContentLoaded", function () {
        if (document.getElementById("gallerySlider")) {
          initGallerySlider();
        }

        // Animation observer (keep this)
        const observerOptions = {
          threshold: 0.1,
          rootMargin: "0px 0px -50px 0px",
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.style.opacity = "1";
              entry.target.style.transform = "translateY(0)";
            }
          });
        }, observerOptions);

        document.querySelectorAll(".tour-card").forEach((card) => {
          card.style.opacity = "0";
          card.style.transform = "translateY(30px)";
          card.style.transition = "opacity 0.6s ease, transform 0.6s ease";
          observer.observe(card);
        });
      });

      // Smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
        anchor.addEventListener("click", function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute("href"));
          if (target) {
            target.scrollIntoView({ behavior: "smooth" });
          }
        });
      });
    </script>
  </body>
</html>
